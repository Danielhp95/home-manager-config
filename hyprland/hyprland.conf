# Welcome to my hyprland.conf!
# Monitors {{{

# No preference
# monitor =,preferred,auto,auto  # In case nothing else works

# Home setup: Denver
monitor=eDP-1, preferred, 1341x1440, 1
monitor=DP-2, preferred, 2560x0, 1
monitor=DP-1, preferred, 2560x0, 1
monitor=HDMI-A-1, preferred, 0x0, 1

workspace= 1, monitor:HDMI-A-1
workspace= 2, monitor:DP-1
workspace= 2, monitor:DP-2
workspace= 9, monitor:eDP-1
# }}}
# Execs {{{
exec-once = hyprctl dispatch movetoworkspace 2 # Start on terminal workspace

# # make sure you have the right environment variables in wayland (TODO: better way to do this?)
exec-once = systemctl --user import-environment DISPLAY WAYLAND_DISPLAY XDG_CURRENT_DESKTOP
exec-once = dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP
exec-once = systemctl --user restart waybar

# exec-once = swww init && sleep 0.1
# exec-once = swww img ~/Pictures/hangmoon/fox_in_the_woods.jpg
exec-once = swww-daemon init && swww-randomise -i 0 ~/Pictures/hangmoon
exec-once = sleep 300 && swww-randomise -i 300 -f 60 -s 2 ~/Pictures/hangmoon

exec-once = mako
exec-once = fcitx5
# }}}
# Envs {{{
env = GLFW_IM_MODULE, fcitx
env = GTK_IM_MODULE, fcitx
env = INPUT_METHOD, fcitx
env = XMODIFIERS, @im=fcitx
env = IMSETTINGS_MODULE, fcitx
env = QT_IM_MODULE, fcitx
env = SDL_IM_MODULE, fcitx

# As per https://wiki.hyprland.org/Nvidia/
# To get multi monitor working
env = LIBVA_DRIVER_NAME,nvidia
# env = XDG_SESSION_TYPE,wayland
# env = GBM_BACKEND,nvidia-drm  # crashes firefox
env = __GLX_VENDOR_LIBRARY_NAME,nvidia
env = WLR_NO_HARDWARE_CURSORS,1

# Which GPU to run Hyprland on. To find card names: ls -l /dev/dri/by-path
env = WLR_DRM_DEVICES,/dev/dri/card0:/dev/dri/card1  # Try amdgpu, otherwise NVIDIA
# env = WLR_DRM_DEVICES,/dev/dri/card0: # amdgpu only. NOT WORKING
# }}}
# Miscelaneous {{{
misc {
  disable_hyprland_logo = true
}

general {
  layout = hy3

  border_size = 5
  col.active_border = 0xffb072d1 0xffb072d1 190  # Does not work
  col.inactive_border = 0xff292a37
  gaps_in = 5
  gaps_out = 10
  sensitivity = 1
}

input {
  follow_mouse = 1
  kb_layout = us
  kb_options = caps:escape
  sensitivity = 0 # -1.0 - 1.0, 0 means no modification.
  touchpad {
    clickfinger_behavior = true # 2 finger right click
    drag_lock = true # can remove finger for a short time while dragging
    natural_scroll = no
  }
}

gestures {
  workspace_swipe = on
  workspace_swipe_distance = 600 # (default is 300)
}
# }}}
# Decoration {{{
$opacity = 0.80
$inactive_opacity = 0.7

decoration {
  active_opacity = $opacity
  col.shadow = rgba(1a1a1aee)
  drop_shadow = yes
  fullscreen_opacity = $opacity
  inactive_opacity = $inactive_opacity
  rounding = 5
  shadow_range = 4
  shadow_render_power = 3
  blur {
    enabled = yes
    size = 7
    passes = 4
    new_optimizations = 1
    ignore_opacity = true
  }
}
# }}}
# Animations {{{
animations {
  enabled = yes

  # Some default animations, see https://wiki.hyprland.org/Configuring/Animations/ for more
  bezier = myBezier, 0.05, 0.9, 0.1, 1.05
  animation = windows, 1, 7, myBezier
  animation = windowsOut, 1, 7, default, popin 80%
  animation = border, 1, 10, default
  animation = borderangle, 1, 8, default
  animation = fade, 1, 7, default
  animation = workspaces, 1, 6, default
}
# }}}
# layout: dwindle {{{
dwindle {
  preserve_split = yes # you probably want this
  pseudotile = yes # master switch for pseudotiling. Enabling is bound to mainMod + P in the keybinds section below
}
# }}}
# layout: hy3 (Plugin) {{{
plugin {
  hy3 {
    # disable gaps when only one window is onscreen
    no_gaps_when_only = true

    # policy controlling what happens when a node is removed from a group,
    # leaving only a group
    # 0 = remove the nested group
    # 1 = keep the nested group
    # 2 = keep the nested group only if its parent is a tab group
    node_collapse_policy = 2

    # offset from group split direction when only one window is in a group
    group_inset = 10

    # if a tab group will automatically be created for the first window spawned in a workspace
    tab_first_window = false

    # tab group settings
    tabs {
      # height of the tab bar
      height = 20

      # padding between the tab bar and its focused node
      padding = 5

      # the tab bar should animate in/out from the top instead of below the window
      from_top = false

      # rounding of tab bar corners
      rounding = 5

      # render the window title on the bar
      render_text = true

      # center the window title
      text_center = true

      # font to render the window title with
      text_font = FiraCode Nerd Font Mono Bold

      # height of the window title
      text_height = 12

      # left padding of the window title
      text_padding = 0

      # active tab bar segment color
      col.active = 0xff32b4ff

      # urgent tab bar segment color
      col.urgent = 0xffff4f4f

      # inactive tab bar segment color
      col.inactive = 0xff808080

      # active tab bar text color
      col.text.active = 0xff000000

      # urgent tab bar text color
      col.text.urgent = 0xff000000

      # inactive tab bar text color
      col.text.inactive = 0xff000000
    }

    # autotiling settings
    autotile {
      # enable autotile
      enable = true

      # make autotile-created groups ephemeral
      ephemeral_groups = true

      # if a window would be squished smaller than this width, a vertical split will be created
      # -1 = never automatically split vertically
      # 0 = always automatically split vertically
      # <number> = pixel height to split at
      trigger_width = 0

      # if a window would be squished smaller than this height, a horizontal split will be created
      # -1 = never automatically split horizontally
      # 0 = always automatically split horizontally
      # <number> = pixel height to split at
      trigger_height = 0

      # a space or comma separated list of workspace ids where autotile should be enabled
      # it's possible to create an exception rule by prefixing the definition with "not:"
      # workspaces = 1,2 # autotiling will only be enabled on workspaces 1 and 2
      # workspaces = not:1,2 # autotiling will be enabled on all workspaces except 1 and 2
      workspaces = not:$messaging_apps  # Don't tile where I keep my messaging apps
    }
  }
}
# }}}
# Binds {{{

binds {
  workspace_back_and_forth = true
  allow_workspace_cycles = true
}

$mainMod = SUPER
bind = $mainMod, Return, exec, wezterm start
bind = $mainMod SHIFT, R, exec, hyprctl reload

# Utilities {{{
bind = $mainMod, D, exec, fuzzel --show-actions
bind = $mainMod SHIFT,  B, exec, bash /home/daniel/nix_config/rofi/scripts/choose_bluetooth_device_from_paired.sh
bind = $mainMod SHIFT,  P, exec, bash /home/daniel/nix_config/rofi/scripts/open_paper.sh
bind = $mainMod SHIFT, S, exec, grimblast copy area
# }}}
# eww {{{
bind = $mainMod SHIFT, M, exec, eww open system-menu --toggle
# }}}
# Normal workspaces {{{
bind = $mainMod, Space, togglefloating

bind = $mainMod, 1, workspace, 1
bind = $mainMod, 2, workspace, 2
bind = $mainMod, 3, workspace, 3
bind = $mainMod, 4, workspace, 4
bind = $mainMod, 5, workspace, 5
bind = $mainMod, 6, workspace, 6
bind = $mainMod, 7, workspace, 7
bind = $mainMod, 8, workspace, 8
bind = $mainMod, 9, workspace, 9
bind = $mainMod, TAB, workspace, previous

bind = $mainMod SHIFT, 1, hy3:movetoworkspace, 1, follow
bind = $mainMod SHIFT, 2, hy3:movetoworkspace, 2, follow
bind = $mainMod SHIFT, 3, hy3:movetoworkspace, 3, follow
bind = $mainMod SHIFT, 4, hy3:movetoworkspace, 4, follow
bind = $mainMod SHIFT, 5, hy3:movetoworkspace, 5, follow
bind = $mainMod SHIFT, 6, hy3:movetoworkspace, 6, follow
bind = $mainMod SHIFT, 7, hy3:movetoworkspace, 7, follow
bind = $mainMod SHIFT, 8, hy3:movetoworkspace, 8, follow
bind = $mainMod SHIFT, 9, hy3:movetoworkspace, 9, follow

bind = $mainMod, comma, workspace,e-1
bind = $mainMod, period, workspace, e+1

bind = $mainMod, h, hy3:movefocus, l
bind = $mainMod, j, hy3:movefocus, d
bind = $mainMod, k, hy3:movefocus, u
bind = $mainMod, l, hy3:movefocus, r
bind = $mainMod, left, hy3:movefocus, l
bind = $mainMod, right, hy3:movefocus, r
bind = $mainMod, down, hy3:movefocus, d
bind = $mainMod, up, hy3:movefocus, u

bind = $mainMod SHIFT, h, hy3:movewindow, l
bind = $mainMod SHIFT, j, hy3:movewindow, d
bind = $mainMod SHIFT, k, hy3:movewindow, u
bind = $mainMod SHIFT, l, hy3:movewindow, r

bind = $mainMod SHIFT, u, hy3:changefocus, raise
bind = $mainMod SHIFT, d, hy3:changefocus, lower
bind = $mainMod SHIFT, r, hy3:changefocus, bottom

bind = $mainMod, t, hy3:changegroup, toggletab
bind = $mainMod, g, hy3:makegroup, tab

bind = $mainMod SHIFT, Q, hy3:killactive,

bind = $mainMod, E, togglesplit, # Change between horizontal / vertical current splits
bind = $mainMod, F, fullscreen
bind = $mainMod, O, toggleopaque
# }}}
# Special workspaces {{{
bind = $mainMod, Minus, togglespecialworkspace
bind = $mainMod, N, togglespecialworkspace, logseq

# TODO: get this for something you want
windowrule = workspace special:logseq, title:^(Logseq)$
windowrule = animation popin, title:^(Logseq)$
windowrule = size 1403 898, title:^(Logseq)$
windowrule = move 8 39, title:^(Logseq)$
windowrule = float, title:^(Logseq)$
# }}}
# Mouse {{{
bindn = , mouse:272, hy3:focustab, mouse

# Does not work
bindn = $mainMod, mouse:272, hy3:movewindow
bindn = $mainMod, mouse:273, resizeactive
# }}}
# Volume / Brighness {{{
binde=$mainMod,F2, exec, brightnessctl set 5%-
binde=$mainMod,F3, exec, brightnessctl set +5%
binde=$mainMod,F6, exec, pactl set-sink-volume 0 -5%
binde=$mainMod,F7, exec, pactl set-sink-volume 0 +5%
bindr=$mainMod,XF86AudioMute, exec, pactl set-sink-mute 0 toggle
bind=$mainMod SHIFT, A, exec, pavucontrol
bind=$mainMod,XF86AudioNext, exec, playerctl next
bind=$mainMod,XF86AudioPlay, exec, playerctl play-pause
bind=$mainMod,XF86AudioPrev, exec, playerctl previous
# }}}
# resize window {{{
bind=$mainMod,R,submap,resize
submap=resize
binde=,right,resizeactive,15 0
binde=,left,resizeactive,-15 0
binde=,up,resizeactive,0 -15
binde=,down,resizeactive,0 15
binde=,l,resizeactive,15 0
binde=,h,resizeactive,-15 0
binde=,k,resizeactive,0 -15
binde=,j,resizeactive,0 15
bind=,escape,submap,reset
submap=reset
# }}}
# }}}
# Window Rules {{{
# Workspace specific applications
windowrulev2 = workspace 1, class:(firefox)
windowrulev2 = workspace 6, class:(steam)$
windowrulev2 = workspace 8, title:(Spotify)$
windowrulev2 = workspace 9, class:(Slack)$
windowrulev2 = workspace 9, class:(org.telegram.desktop)
windowrulev2 = workspace 9, class:(Element)

# Floating windows
windowrule = float, pavucontrol
windowrule = float, blueberry
windowrule = float, mpv
windowrule = float, imv

# Opacity configuration
windowrulev2 = opacity 1 override, 1 override, class:(org.wezfurlong.wezterm)
windowrule = opacity 1.0 override 1.0 override, firefox
windowrule = opacity 1.0 override 1.0 override, mpv
windowrule = opacity 1.0 override 1.0 override, Zoom
windowrule = opacity 1.0 override 1.0 override, matplotlib
windowrulev2 = opacity 1.0 override 1.0 override, class:(steam_app_)(.*) # doesn't work
# }}}
# vim: set foldmethod=marker foldlevel=0:
